<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <link rel="stylesheet" type="text/css" href="{{ url_for('flow/static', file='css/flow_viewer.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', file='css/mx_page.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', file='css/font-awesome-4.3.0.css') }}">
    <script type="text/javascript" src="{{ url_for('flow/static', file='js/d3-3.5.17.min.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('flow/static', file='js/dagre-d3-0.4.17.min.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('flow/static', file='js/flow_viewer.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', file='js/mx_utils.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', file='js/jquery-2.1.4.min.js') }}"></script>
    <title>Flow Viewer</title>
</head>

<body>

<form style="text-align: left">
    <input type="button" class="action_button fa-input" value="&#xf04e;&nbsp;Recover" onclick="window.close()"/>
</form>

<script type="text/javascript">
    var mx_flow = {{ details|jsonify|safe }};
</script>

<div class="tile_component">
    <ul class="fa-ul">
        <li title="Process Name"><i class="fa-li fa fa-terminal"></i> + process_entry.process_name +</li>
        <li title="Timeperiod"><i class="fa-li fa fa-clock-o"></i> + job_entry.timeperiod +</li>
        <li title="State"><i class="fa-li fa fa-flag-o"></i> + job_entry.state +</li>
    </ul>

    {% set url = 'action=action/get_uow_log' + '&process_name=' + job_entry.process_name + '&timeperiod=' + job_entry.timeperiod %}
    <form method="GET" onsubmit="window.open('/viewer/object/?{{ url }}','Uow Log',
         'toolbar=no,scrollbars=yes,resizable=yes,top=250,left=250,width=800,height=480'); return false;">
        <input type="submit" class="action_button fa-input" title="Uow Log" value="&#xf0f6;&nbsp;Uow&nbsp;Log"/>
    </form>

    <form onsubmit="process_job('action/reprocess', {{ tree_name }}, {{ process_name }}, {{ timeperiod }});">
        <input type="hidden" name="process_name" value="{{ process_name }}" />
        <input type="hidden" name="timeperiod" value="{{ timeperiod }}" />
        <input type="submit" title="Reprocess" class="action_button fa-repeat" value="&#xf01e;&nbsp;Reprocess"/>
    </form>
</div>



<form style="text-align: left">
    <input type="button" class="action_button fa-input" value="&#xf051;&nbsp;Run&nbsp;One" onclick="window.close()"/>
</form>

<div class="live map">
    <svg>
        <g/>
    </svg>
</div>

<form style="text-align: center">
    <input type="button" class="action_button fa-input" value="&#xf00d;&nbsp;Close" onclick="window.close()"/>
</form>

<script type="text/javascript">
    $(document).ready(function () {
//        var action = get_url_parameter('action');
//        var url = '/' + action + '/?' + window.location.search.substring(1);
        var url = "{{ url_for('flow/static', file='js/flare.json') }}";

        $.get(url, function (data) {
            render_flow(data, d3.select("#flow"));
        });
    });
</script>

</body>
</html>
