<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <link rel="stylesheet" type="text/css" href="{{ url_for('flow/static', file='css/flow_viewer.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('flow/static', file='css/jquery.tipsy.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', file='css/mx_page.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', file='css/font-awesome.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', file='css/alertify.css') }}">
    <script type="text/javascript" src="{{ url_for('flow/static', file='js/d3-3.5.17.min.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('flow/static', file='js/dagre-d3-0.4.17.min.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('flow/static', file='js/flow_viewer.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', file='js/jquery-3.1.1.min.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('flow/static', file='js/jquery.tipsy.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', file='js/mx_utils.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', file='js/alertify-0.3.17.trunk.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', file='js/context_menu.js') }}"></script>
    <title>Workflow Viewer</title>
</head>

<body>

<div id="flow_header">
    <div id="tab_buttons" class="tab">
        <button class="tablinks" onclick="change_tab(event, 'managed')">Managed</button>
        <button class="tablinks" onclick="change_tab(event, 'freerun')">Freerun</button>
        <!-- freerun buttons are added by the  -->
    </div>
</div>

<div id="user_message" class="clear user_message">
</div>

<div class="live map">
    <svg>
        <g/>
    </svg>
</div>

<form style="text-align: center">
    <input type="button" class="action_button fa-input" value="&#xf00d;&nbsp;Close" onclick="window.close()"/>
</form>

<script type="text/javascript">
    function change_tab(evt, tab_id) {
        if (evt.currentTarget.className.includes(" active")) {
            // tab is currently active. avoid re-rendering it
            return;
        }

        // hide all elements with class="tabcontent"
        var i;
        var tabcontent = document.getElementsByClassName("tabcontent");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }

        // remove class "active" from all elements with class="tablinks"
        var tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }

        // show the tab, and add an "active" class to the button that opened the tab
        document.getElementById(tab_id).style.display = "block";
        evt.currentTarget.className += " active";
    }
</script>

<script type="text/javascript">
    var mx_flow = {{ flow_details|jsonify|safe }};
    var process_name = "{{ process_name|safe }}";
    var active_run_mode = "{{ active_run_mode|safe }}";
    var freerun_uows = {{ freerun_uows|jsonify|safe }};

    // if the mx_flow is not available for this process
    if (Object.keys(mx_flow).length === 0) {
        render_empty_response($("#user_message"), process_name);
    }

    $(function () {  // former $(document).ready(function () {...})
        render_flow_header($("#flow_header"), mx_flow, process_name, active_run_mode, "managed", process_name);

        for (var freerun_uow in freerun_uows) {
            <button class="tablinks" onclick="change_tab(event, 'managed')">Managed</button>
            render_flow_header($("#flow_header"), mx_flow, process_name, active_run_mode, "freerun", freerun_uow.process_name);
        }
        render_flow_graph(mx_flow.graph, d3.select("#flow"));
    });
</script>

</body>
</html>
